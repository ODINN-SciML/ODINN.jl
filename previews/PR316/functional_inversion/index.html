<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Functional inversion · ODINN.jl</title><meta name="title" content="Functional inversion · ODINN.jl"/><meta property="og:title" content="Functional inversion · ODINN.jl"/><meta property="twitter:title" content="Functional inversion · ODINN.jl"/><meta name="description" content="Documentation for ODINN.jl."/><meta property="og:description" content="Documentation for ODINN.jl."/><meta property="twitter:description" content="Documentation for ODINN.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.png" alt="ODINN.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">ODINN.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox" checked/><label class="tocitem" for="menuitem-2"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../forward_simulation/">Forward simulation</a></li><li class="is-active"><a class="tocitem" href>Functional inversion</a><ul class="internal"><li><a class="tocitem" href="#Forward-simulation-tutorial"><span>Forward simulation tutorial</span></a></li><li class="toplevel"><a class="tocitem" href="####-Step-by-step-explanation-of-the-tutorial"><span>### Step-by-step explanation of the tutorial</span></a></li><li class="toplevel"><a class="tocitem" href="#Here-we-will-cover-in-detail-each-one-of-the-steps-that-lead-us-to-run-the"><span>Here we will cover in detail each one of the steps that lead us to run the</span></a></li><li class="toplevel"><a class="tocitem" href="#Prediction-from-the-previous-example-(i.e.-a-forward-run).-This-first-tutorial-keeps-things-simple,-and-since"><span><code>Prediction</code> from the previous example (i.e. a forward run). This first tutorial keeps things simple, and since</span></a></li><li class="toplevel"><a class="tocitem" href="#we-are-not-using-machine-learning-models,-we-will-only-use-the-Model-type-to-specify-the-iceflow-and-mass-balance-models.-These-functionalities"><span>we are not using machine learning models, we will only use the <code>Model</code> type to specify the iceflow and mass balance models. These functionalities</span></a></li><li class="toplevel"><a class="tocitem" href="#are-mainly-covered-by-Huginn.jl."><span>are mainly covered by <code>Huginn.jl</code>.</span></a></li><li class="toplevel"><a class="tocitem" href="#####-Step-1:-Parameter-initialization"><span>#### Step 1: Parameter initialization</span></a></li><li class="toplevel"><a class="tocitem" href="#The-first-step-is-to-initialize-and-specify-all-the-necessary-parameters.-In-ODINN.jl"><span>The first step is to initialize and specify all the necessary parameters. In ODINN.jl</span></a></li><li class="toplevel"><a class="tocitem" href="#we-have-many-different-types-of-parameters,-specifying-different-aspects-of-the-model."><span>we have many different types of parameters, specifying different aspects of the model.</span></a></li><li class="toplevel"><a class="tocitem" href="#All-the-parameter-types-come-with-a-default-constructor,-which-will-provide-default"><span>All the parameter types come with a default constructor, which will provide default</span></a></li><li class="toplevel"><a class="tocitem" href="#values-in-case-you-don&#39;t-want-to-tune-those.-The-main-types-of-parameters-are:"><span>values in case you don&#39;t want to tune those. The main types of parameters are:</span></a></li><li class="toplevel"><a class="tocitem" href="#*Simulation-parameters*:-SimulationParameters-includes-all-the-parameters-related-to-the"><span>- <em>Simulation parameters</em>: <code>SimulationParameters</code> includes all the parameters related to the</span></a></li><li class="toplevel"><a class="tocitem" href="#ODINN.jl-simulation,-including-the-number-of-workers,-the-timespan"><span>ODINN.jl simulation, including the number of workers, the timespan</span></a></li><li class="toplevel"><a class="tocitem" href="#of-the-simulation-or-the-working-directory."><span>of the simulation or the working directory.</span></a></li><li class="toplevel"><a class="tocitem" href="#*PhysicalParameters*:-PhysicalParameters-includes-all-the-necessary-physical-parameters-for-the-model."><span>- <em>PhysicalParameters</em>: <code>PhysicalParameters</code> includes all the necessary physical parameters for the model.</span></a></li><li class="toplevel"><a class="tocitem" href="#*SolverParameters*:-SolverParameters-includes-all-the-necessary-parameters-for-the-solver."><span>- <em>SolverParameters</em>: <code>SolverParameters</code> includes all the necessary parameters for the solver.</span></a></li><li class="toplevel"><a class="tocitem" href="#*Hyperparameters*:-Hyperparameters-includes-all-the-necessary-hyperparameters-for-a-machine-learning-model."><span>- <em>Hyperparameters</em>: <code>Hyperparameters</code> includes all the necessary hyperparameters for a machine learning model.</span></a></li><li class="toplevel"><a class="tocitem" href="#*UDEparameters*:-UDEparameters-contains-the-parameters-related-to-the-training-of-a-Universal-Differential-Equation."><span>- <em>UDEparameters</em>: <code>UDEparameters</code> contains the parameters related to the training of a Universal Differential Equation.</span></a></li><li class="toplevel"><a class="tocitem" href="#All-these-sub-types-of-parameters-are-held-in-a-Parameters-struct,-a-general"><span>All these sub-types of parameters are held in a <code>Parameters</code> struct, a general</span></a></li><li class="toplevel"><a class="tocitem" href="#parameters-structure-to-be-passed-to-an-ODINN-simulation."><span>parameters structure to be passed to an ODINN simulation.</span></a></li><li class="toplevel"><a class="tocitem" href="#First-we-need-to-specify-a-list-of-RGI-IDs-of-the-glacier-we-want-to-work-with.-Specifying-an-RGI"><span>First we need to specify a list of RGI IDs of the glacier we want to work with. Specifying an RGI</span></a></li><li class="toplevel"><a class="tocitem" href="#region-is-also-possible.-From-these-RGI-IDs,-we-will-look-for-the-necessary-files-inside-the-workspace."><span>region is also possible. From these RGI IDs, we will look for the necessary files inside the workspace.</span></a></li><li class="toplevel"><a class="tocitem" href="#Filter-out-glaciers-that-are-not-used-to-avoid-having-references-that-depend-on-all-the-glaciers-processed-in-Gungnir"><span>Filter out glaciers that are not used to avoid having references that depend on all the glaciers processed in Gungnir</span></a></li><li><a class="tocitem" href="#Define-the-time-step-for-the-simulation-output-and-for-the-adjoint-calculation.-In-this-case,-a-month."><span>Define the time step for the simulation output and for the adjoint calculation. In this case, a month.</span></a></li><li class="toplevel"><a class="tocitem" href="#####-Step-2:-Model-specification"><span>#### Step 2: Model specification</span></a></li><li class="toplevel"><a class="tocitem" href="#The-next-step-is-to-specify-which-model(s)-we-want-to-use-for-our-simulation.-In-ODINN"><span>The next step is to specify which model(s) we want to use for our simulation. In ODINN</span></a></li><li class="toplevel"><a class="tocitem" href="#we-have-three-different-types-of-model,-which-are-encompassed-in-a-Model-structure:"><span>we have three different types of model, which are encompassed in a <code>Model</code> structure:</span></a></li><li class="toplevel"><a class="tocitem" href="#*Iceflow-model*:-IceflowModel-is-the-ice-flow-dynamics-model-that-will-be-used-to-simulate"><span>- <em>Iceflow model</em>: <code>IceflowModel</code> is the ice flow dynamics model that will be used to simulate</span></a></li><li class="toplevel"><a class="tocitem" href="#iceflow.-It-defaults-to-a-2D-Shallow-Ice-Approximation."><span>iceflow. It defaults to a 2D Shallow Ice Approximation.</span></a></li><li class="toplevel"><a class="tocitem" href="#*Surface-mass-balance-model*:-MassBalanceModel-is-the-mass-balance-model-that-will-be-used-for"><span>- <em>Surface mass balance model</em>: <code>MassBalanceModel</code> is the mass balance model that will be used for</span></a></li><li class="toplevel"><a class="tocitem" href="#simulations.-Options-here-include-temperature-index-models,-or"><span>simulations. Options here include temperature-index models, or</span></a></li><li class="toplevel"><a class="tocitem" href="#machine-learning-models-coming-from-MassBalanceMachine."><span>machine learning models coming from <code>MassBalanceMachine</code>.</span></a></li><li class="toplevel"><a class="tocitem" href="#*Machine-learning-model*:-MLmodel-is-the-machine-learning-model-(e.g.-a-neural-network)-which-will"><span>- <em>Machine learning model</em>: <code>MLmodel</code> is the machine learning model (e.g. a neural network) which will</span></a></li><li class="toplevel"><a class="tocitem" href="#be-used-as-part-of-a-hybrid-model-based-on-a-Universal-Differential-Equation."><span>be used as part of a hybrid model based on a Universal Differential Equation.</span></a></li><li class="toplevel"><a class="tocitem" href="#Generally,-a-model-can-be-initialized-directly-using-the-Model-constructor:"><span>Generally, a model can be initialized directly using the <code>Model</code> constructor:</span></a></li><li class="toplevel"><a class="tocitem" href="#####-Step-3:-Glacier-initialization"><span>#### Step 3: Glacier initialization</span></a></li><li class="toplevel"><a class="tocitem" href="#The-third-step-is-to-fetch-and-initialize-all-the-necessary-data-for-our-glaciers-of-interest."><span>The third step is to fetch and initialize all the necessary data for our glaciers of interest.</span></a></li><li class="toplevel"><a class="tocitem" href="#This-is-strongly-built-on-top-of-OGGM,-mostly-providing-a-Julia-interface-to-automatize-this.-The-package"><span>This is strongly built on top of OGGM, mostly providing a Julia interface to automatize this. The package</span></a></li><li class="toplevel"><a class="tocitem" href="#Gungnir-is-used-to-fetch-the-necessary-data-from-the-RGI-and-other-sources.-The-data-is-then-stored-in-servers"><span>Gungnir is used to fetch the necessary data from the RGI and other sources. The data is then stored in servers</span></a></li><li class="toplevel"><a class="tocitem" href="#and-fetched-and-read-using-Rasters.jl-directly-by-Sleipnir.jl-when-needed."><span>and fetched and read using <code>Rasters.jl</code> directly by <code>Sleipnir.jl</code> when needed.</span></a></li><li class="toplevel"><a class="tocitem" href="#Then,-we-initialize-those-glaciers-based-on-those-RGI-IDs-and-the-parameters-we-previously-specified."><span>Then, we initialize those glaciers based on those RGI IDs and the parameters we previously specified.</span></a></li><li class="toplevel"><a class="tocitem" href="#####-Step-4:-Running-a-forward-simulation-as-a-synthetic-ground-truth"><span>#### Step 4: Running a forward simulation as a synthetic ground truth</span></a></li><li class="toplevel"><a class="tocitem" href="#for-each-glacier-at-each-time-step.-The-dataset-will-be-used-to-train-the-machine-learning-model."><span>for each glacier at each time step. The dataset will be used to train the machine learning model.</span></a></li><li class="toplevel"><a class="tocitem" href="#We-define-the-time-snapshots-for-transient-inversion,-i.e.-the-time-steps-at-which-we-want-to-save-the-results,-which-will-be-used"><span>We define the time snapshots for transient inversion, i.e. the time steps at which we want to save the results, which will be used</span></a></li><li class="toplevel"><a class="tocitem" href="#to-compute-the-adjoint-in-reverse-mode."><span>to compute the adjoint in reverse mode.</span></a></li><li class="toplevel"><a class="tocitem" href="#We-define-a-synthetic-law-to-generate-the-synthetic-dataset.-For-this,-we-use-the-data-from-a-table-in-Cuffey-and-Paterson-(2010)."><span>We define a synthetic law to generate the synthetic dataset. For this, we use the data from a table in Cuffey and Paterson (2010).</span></a></li><li class="toplevel"><a class="tocitem" href="#We-generate-the-synthetic-dataset-using-the-forward-simulation.-This-will-generate-a-dataset-with-the-ice-thickness-and-surface-velocities"><span>We generate the synthetic dataset using the forward simulation. This will generate a dataset with the ice thickness and surface velocities</span></a></li><li class="toplevel"><a class="tocitem" href="#for-each-glacier-at-each-time-step.-The-dataset-will-be-used-to-train-the-machine-learning-model.-This-will-run-under-the-hood"><span>for each glacier at each time step. The dataset will be used to train the machine learning model. This will run under the hood</span></a></li><li class="toplevel"><a class="tocitem" href="#a-Prediction-using-Huginn.jl."><span>a <code>Prediction</code> using <code>Huginn.jl</code>.</span></a></li><li class="toplevel"><a class="tocitem" href="#####-Step-5:-Train-a-Universal-Differential-Equation-via-a-functional-inversion"><span>#### Step 5: Train a Universal Differential Equation via a functional inversion</span></a></li><li class="toplevel"><a class="tocitem" href="#The-next-step-is-to-specify-the-type-of-simulation-we-want-to-perform.-In-this-case,-we-will-use-a-FunctionalInversion-simulation,"><span>The next step is to specify the type of simulation we want to perform. In this case, we will use a <code>FunctionalInversion</code> simulation,</span></a></li><li class="toplevel"><a class="tocitem" href="#which-will-use-the-synthetic-dataset-generated-in-the-previous-step-to-train-a-Universal-Differential-Equation-(UDE)-model."><span>which will use the synthetic dataset generated in the previous step to train a Universal Differential Equation (UDE) model.</span></a></li><li class="toplevel"><a class="tocitem" href="#And-finally,-we-just-run-the-simulation.-This-will-run-the-adjoint-method-to-compute-the-gradients-and-then-use-the-ADAM-optimizer"><span>And finally, we just run the simulation. This will run the adjoint method to compute the gradients and then use the ADAM optimizer</span></a></li><li class="toplevel"><a class="tocitem" href="#to-train-the-UDE-model."><span>to train the UDE model.</span></a></li></ul></li></ul></li><li><a class="tocitem" href="../funcs_types/">Types and functions</a></li><li><a class="tocitem" href="../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Functional inversion</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Functional inversion</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/ODINN-SciML/ODINN.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/ODINN-SciML/ODINN.jl/blob/main/docs/src/functional_inversion.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h2 id="Forward-simulation-tutorial"><a class="docs-heading-anchor" href="#Forward-simulation-tutorial">Forward simulation tutorial</a><a id="Forward-simulation-tutorial-1"></a><a class="docs-heading-anchor-permalink" href="#Forward-simulation-tutorial" title="Permalink"></a></h2><pre><code class="language-julia hljs"># This tutorial provides a simple example on how to perform a functional inversion using Universal Differential Equations (UDEs) in ODINN.jl.
# For this, we will generate a synthetic dataset using a forward simulation, and then we will use this dataset to perform the functional inversion.
## The goal of this functional inversion will be to learn a synthetic law that maps `A`, i.e. the ice rigidity, to long-term changes in atmospheric surface temperature.

using ODINN

# Define the working directory
working_dir = joinpath(homedir(), &quot;ODINN_simulations&quot;)

## We fetch the paths with the files for the available glaciers on disk
rgi_paths = get_rgi_paths()

# Ensure the working directory exists
mkpath(working_dir)

# Define which glacier RGI IDs we want to work with
rgi_ids = [&quot;RGI60-11.03638&quot;, &quot;RGI60-11.01450&quot;, &quot;RGI60-11.02346&quot;, &quot;RGI60-07.00065&quot;, &quot;RGI60-08.00147&quot;,&quot;RGI60-07.00042&quot;]
# Filter out glaciers that are not used to avoid having references that depend on all the glaciers processed in Gungnir
rgi_paths = Dict(k =&gt; rgi_paths[k] for k in rgi_ids)
# Define the time step for the simulation output and for the adjoint calculation. In this case, a month.
δt = 1/12

params = Parameters(simulation = SimulationParameters(working_dir=working_dir,
                                                    use_MB=false,
                                                    velocities=true,
                                                    tspan=(2010.0, 2015.0),
                                                    step=δt,
                                                    multiprocessing=true,
                                                    workers=7,
                                                    test_mode=false,
                                                    rgi_paths=rgi_paths),
                    hyper = Hyperparameters(batch_size=length(rgi_ids), # We set batch size equals all datasize so we test gradient
                                            epochs=[20,30],
                                            optimizer=[ODINN.ADAM(0.005), ODINN.LBFGS()]),
                    physical = PhysicalParameters(minA = 8e-21,
                                                  maxA = 8e-17),
                    UDE = UDEparameters(optim_autoAD=ODINN.NoAD(),
                                        grad=ContinuousAdjoint(),
                                        optimization_method=&quot;AD+AD&quot;,
                                        target = :A),
                    solver = Huginn.SolverParameters(step=δt,
                                                     save_everystep=true,
                                                     progress=true)
                    )

model = Model(iceflow = SIA2Dmodel(params),
                mass_balance = TImodel1(params; DDF=6.0/1000.0, acc_factor=1.2/1000.0),
                machine_learning = NeuralNetwork(params))

# We initialize the glaciers with all the necessary data
glaciers = initialize_glaciers(rgi_ids, params)

# Time snapshots for transient inversion
tstops = collect(2010:δt:2015)

# We define a synthetic law to generate the synthetic dataset. For this, we use some tabular data from Cuffey and Paterson (2010).
A_poly = ODINN.A_law_PatersonCuffey()
fakeA(T) = A_poly(T)

# We generate the synthetic dataset using the forward simulation. This will generate a dataset with the ice thickness and surface velocities
# for each glacier at each time step. The dataset will be used to train the machine learning model.
ODINN.generate_ground_truth(glaciers, :PatersonCuffey, params, model, tstops)

## After this forward simulation, we restart the iceflow model to be ready for the inversions
model.iceflow = SIA2Dmodel(params)

# We specify the type of simulation we want to perform
functional_inversion = FunctionalInversion(model, glaciers, params)

# And finally, we just run the simulation
run!(functional_inversion)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">[ Info: Filtering out these glaciers from RGI ID list: Any[]
Getting raw climate data for: RGI60-07.00065
Getting raw climate data for: RGI60-08.00147
Getting raw climate data for: RGI60-07.00042
[ Info: Running forward in-place PDE ice flow model
Processing glacier RGI60-11.03638 for PDE forward simulation
Processing glacier RGI60-11.01450 for PDE forward simulation
Progress:  33%|█████████████▋                           |  ETA: 0:00:07Processing glacier RGI60-11.02346 for PDE forward simulation
Processing glacier RGI60-07.00065 for PDE forward simulation
Progress:  67%|███████████████████████████▍             |  ETA: 0:00:02Processing glacier RGI60-08.00147 for PDE forward simulation
Processing glacier RGI60-07.00042 for PDE forward simulation
Progress: 100%|█████████████████████████████████████████| Time: 0:00:05
Running training of UDE...

[ Info: Training with ADAM optimizer
[ Info: Training with custom ContinuousAdjoint{Float64, Int64, DiscreteVJP} method
Training iceflow UDE...
Iteration: [    1 /    50]     Loss:1.15722e+02
Iteration: [    2 /    50]     Loss:1.06552e+02     Improvement: -7.92 %
Iteration: [    3 /    50]     Loss:9.82886e+01     Improvement: -7.76 %
Iteration: [    4 /    50]     Loss:9.08879e+01     Improvement: -7.53 %
Iteration: [    5 /    50]     Loss:8.42368e+01     Improvement: -7.32 %
Iteration: [    6 /    50]     Loss:7.82189e+01     Improvement: -7.14 %
Iteration: [    7 /    50]     Loss:7.27387e+01     Improvement: -7.01 %
Iteration: [    8 /    50]     Loss:6.77234e+01     Improvement: -6.89 %
Iteration: [    9 /    50]     Loss:6.31209e+01     Improvement: -6.80 %
Iteration: [   10 /    50]     Loss:5.88945e+01     Improvement: -6.70 %
Iteration: [   11 /    50]     Loss:5.50183e+01     Improvement: -6.58 %
Iteration: [   12 /    50]     Loss:5.14725e+01     Improvement: -6.44 %
Iteration: [   13 /    50]     Loss:4.82404e+01     Improvement: -6.28 %
Iteration: [   14 /    50]     Loss:4.53054e+01     Improvement: -6.08 %
Iteration: [   15 /    50]     Loss:4.26499e+01     Improvement: -5.86 %
Iteration: [   16 /    50]     Loss:4.02542e+01     Improvement: -5.62 %
Iteration: [   17 /    50]     Loss:3.80967e+01     Improvement: -5.36 %
Iteration: [   18 /    50]     Loss:3.61543e+01     Improvement: -5.10 %
Iteration: [   19 /    50]     Loss:3.44038e+01     Improvement: -4.84 %
Iteration: [   20 /    50]     Loss:3.44038e+01     Improvement: 0.00 %
[ Info: Trainign with BFGS optimizer
[ Info: Training with custom ContinuousAdjoint{Float64, Int64, DiscreteVJP} method
Training iceflow UDE...
Iteration: [   21 /    50]     Loss:3.44038e+01     Improvement: 0.00 %
Iteration: [   22 /    50]     Loss:8.66536e+00     Improvement: -74.81 %</code></pre><h1 id="-Step-by-step-explanation-of-the-tutorial"><a class="docs-heading-anchor" href="####-Step-by-step-explanation-of-the-tutorial">### Step-by-step explanation of the tutorial</a><a id="-Step-by-step-explanation-of-the-tutorial-1"></a><a class="docs-heading-anchor-permalink" href="####-Step-by-step-explanation-of-the-tutorial" title="Permalink"></a></h1><h1 id="Here-we-will-cover-in-detail-each-one-of-the-steps-that-lead-us-to-run-the"><a class="docs-heading-anchor" href="#Here-we-will-cover-in-detail-each-one-of-the-steps-that-lead-us-to-run-the">Here we will cover in detail each one of the steps that lead us to run the</a><a id="Here-we-will-cover-in-detail-each-one-of-the-steps-that-lead-us-to-run-the-1"></a><a class="docs-heading-anchor-permalink" href="#Here-we-will-cover-in-detail-each-one-of-the-steps-that-lead-us-to-run-the" title="Permalink"></a></h1><h1 id="Prediction-from-the-previous-example-(i.e.-a-forward-run).-This-first-tutorial-keeps-things-simple,-and-since"><a class="docs-heading-anchor" href="#Prediction-from-the-previous-example-(i.e.-a-forward-run).-This-first-tutorial-keeps-things-simple,-and-since"><code>Prediction</code> from the previous example (i.e. a forward run). This first tutorial keeps things simple, and since</a><a id="Prediction-from-the-previous-example-(i.e.-a-forward-run).-This-first-tutorial-keeps-things-simple,-and-since-1"></a><a class="docs-heading-anchor-permalink" href="#Prediction-from-the-previous-example-(i.e.-a-forward-run).-This-first-tutorial-keeps-things-simple,-and-since" title="Permalink"></a></h1><h1 id="we-are-not-using-machine-learning-models,-we-will-only-use-the-Model-type-to-specify-the-iceflow-and-mass-balance-models.-These-functionalities"><a class="docs-heading-anchor" href="#we-are-not-using-machine-learning-models,-we-will-only-use-the-Model-type-to-specify-the-iceflow-and-mass-balance-models.-These-functionalities">we are not using machine learning models, we will only use the <code>Model</code> type to specify the iceflow and mass balance models. These functionalities</a><a id="we-are-not-using-machine-learning-models,-we-will-only-use-the-Model-type-to-specify-the-iceflow-and-mass-balance-models.-These-functionalities-1"></a><a class="docs-heading-anchor-permalink" href="#we-are-not-using-machine-learning-models,-we-will-only-use-the-Model-type-to-specify-the-iceflow-and-mass-balance-models.-These-functionalities" title="Permalink"></a></h1><h1 id="are-mainly-covered-by-Huginn.jl."><a class="docs-heading-anchor" href="#are-mainly-covered-by-Huginn.jl.">are mainly covered by <code>Huginn.jl</code>.</a><a id="are-mainly-covered-by-Huginn.jl.-1"></a><a class="docs-heading-anchor-permalink" href="#are-mainly-covered-by-Huginn.jl." title="Permalink"></a></h1><h1 id="-Step-1:-Parameter-initialization"><a class="docs-heading-anchor" href="#####-Step-1:-Parameter-initialization">#### Step 1: Parameter initialization</a><a id="-Step-1:-Parameter-initialization-1"></a><a class="docs-heading-anchor-permalink" href="#####-Step-1:-Parameter-initialization" title="Permalink"></a></h1><h1 id="The-first-step-is-to-initialize-and-specify-all-the-necessary-parameters.-In-ODINN.jl"><a class="docs-heading-anchor" href="#The-first-step-is-to-initialize-and-specify-all-the-necessary-parameters.-In-ODINN.jl">The first step is to initialize and specify all the necessary parameters. In ODINN.jl</a><a id="The-first-step-is-to-initialize-and-specify-all-the-necessary-parameters.-In-ODINN.jl-1"></a><a class="docs-heading-anchor-permalink" href="#The-first-step-is-to-initialize-and-specify-all-the-necessary-parameters.-In-ODINN.jl" title="Permalink"></a></h1><h1 id="we-have-many-different-types-of-parameters,-specifying-different-aspects-of-the-model."><a class="docs-heading-anchor" href="#we-have-many-different-types-of-parameters,-specifying-different-aspects-of-the-model.">we have many different types of parameters, specifying different aspects of the model.</a><a id="we-have-many-different-types-of-parameters,-specifying-different-aspects-of-the-model.-1"></a><a class="docs-heading-anchor-permalink" href="#we-have-many-different-types-of-parameters,-specifying-different-aspects-of-the-model." title="Permalink"></a></h1><h1 id="All-the-parameter-types-come-with-a-default-constructor,-which-will-provide-default"><a class="docs-heading-anchor" href="#All-the-parameter-types-come-with-a-default-constructor,-which-will-provide-default">All the parameter types come with a default constructor, which will provide default</a><a id="All-the-parameter-types-come-with-a-default-constructor,-which-will-provide-default-1"></a><a class="docs-heading-anchor-permalink" href="#All-the-parameter-types-come-with-a-default-constructor,-which-will-provide-default" title="Permalink"></a></h1><h1 id="values-in-case-you-don&#39;t-want-to-tune-those.-The-main-types-of-parameters-are:"><a class="docs-heading-anchor" href="#values-in-case-you-don&#39;t-want-to-tune-those.-The-main-types-of-parameters-are:">values in case you don&#39;t want to tune those. The main types of parameters are:</a><a id="values-in-case-you-don&#39;t-want-to-tune-those.-The-main-types-of-parameters-are:-1"></a><a class="docs-heading-anchor-permalink" href="#values-in-case-you-don&#39;t-want-to-tune-those.-The-main-types-of-parameters-are:" title="Permalink"></a></h1><h1 id="*Simulation-parameters*:-SimulationParameters-includes-all-the-parameters-related-to-the"><a class="docs-heading-anchor" href="#*Simulation-parameters*:-SimulationParameters-includes-all-the-parameters-related-to-the">- <em>Simulation parameters</em>: <code>SimulationParameters</code> includes all the parameters related to the</a><a id="*Simulation-parameters*:-SimulationParameters-includes-all-the-parameters-related-to-the-1"></a><a class="docs-heading-anchor-permalink" href="#*Simulation-parameters*:-SimulationParameters-includes-all-the-parameters-related-to-the" title="Permalink"></a></h1><h1 id="ODINN.jl-simulation,-including-the-number-of-workers,-the-timespan"><a class="docs-heading-anchor" href="#ODINN.jl-simulation,-including-the-number-of-workers,-the-timespan">ODINN.jl simulation, including the number of workers, the timespan</a><a id="ODINN.jl-simulation,-including-the-number-of-workers,-the-timespan-1"></a><a class="docs-heading-anchor-permalink" href="#ODINN.jl-simulation,-including-the-number-of-workers,-the-timespan" title="Permalink"></a></h1><h1 id="of-the-simulation-or-the-working-directory."><a class="docs-heading-anchor" href="#of-the-simulation-or-the-working-directory.">of the simulation or the working directory.</a><a id="of-the-simulation-or-the-working-directory.-1"></a><a class="docs-heading-anchor-permalink" href="#of-the-simulation-or-the-working-directory." title="Permalink"></a></h1><h1 id="*PhysicalParameters*:-PhysicalParameters-includes-all-the-necessary-physical-parameters-for-the-model."><a class="docs-heading-anchor" href="#*PhysicalParameters*:-PhysicalParameters-includes-all-the-necessary-physical-parameters-for-the-model.">- <em>PhysicalParameters</em>: <code>PhysicalParameters</code> includes all the necessary physical parameters for the model.</a><a id="*PhysicalParameters*:-PhysicalParameters-includes-all-the-necessary-physical-parameters-for-the-model.-1"></a><a class="docs-heading-anchor-permalink" href="#*PhysicalParameters*:-PhysicalParameters-includes-all-the-necessary-physical-parameters-for-the-model." title="Permalink"></a></h1><h1 id="*SolverParameters*:-SolverParameters-includes-all-the-necessary-parameters-for-the-solver."><a class="docs-heading-anchor" href="#*SolverParameters*:-SolverParameters-includes-all-the-necessary-parameters-for-the-solver.">- <em>SolverParameters</em>: <code>SolverParameters</code> includes all the necessary parameters for the solver.</a><a id="*SolverParameters*:-SolverParameters-includes-all-the-necessary-parameters-for-the-solver.-1"></a><a class="docs-heading-anchor-permalink" href="#*SolverParameters*:-SolverParameters-includes-all-the-necessary-parameters-for-the-solver." title="Permalink"></a></h1><h1 id="*Hyperparameters*:-Hyperparameters-includes-all-the-necessary-hyperparameters-for-a-machine-learning-model."><a class="docs-heading-anchor" href="#*Hyperparameters*:-Hyperparameters-includes-all-the-necessary-hyperparameters-for-a-machine-learning-model.">- <em>Hyperparameters</em>: <code>Hyperparameters</code> includes all the necessary hyperparameters for a machine learning model.</a><a id="*Hyperparameters*:-Hyperparameters-includes-all-the-necessary-hyperparameters-for-a-machine-learning-model.-1"></a><a class="docs-heading-anchor-permalink" href="#*Hyperparameters*:-Hyperparameters-includes-all-the-necessary-hyperparameters-for-a-machine-learning-model." title="Permalink"></a></h1><h1 id="*UDEparameters*:-UDEparameters-contains-the-parameters-related-to-the-training-of-a-Universal-Differential-Equation."><a class="docs-heading-anchor" href="#*UDEparameters*:-UDEparameters-contains-the-parameters-related-to-the-training-of-a-Universal-Differential-Equation.">- <em>UDEparameters</em>: <code>UDEparameters</code> contains the parameters related to the training of a Universal Differential Equation.</a><a id="*UDEparameters*:-UDEparameters-contains-the-parameters-related-to-the-training-of-a-Universal-Differential-Equation.-1"></a><a class="docs-heading-anchor-permalink" href="#*UDEparameters*:-UDEparameters-contains-the-parameters-related-to-the-training-of-a-Universal-Differential-Equation." title="Permalink"></a></h1><h1 id="All-these-sub-types-of-parameters-are-held-in-a-Parameters-struct,-a-general"><a class="docs-heading-anchor" href="#All-these-sub-types-of-parameters-are-held-in-a-Parameters-struct,-a-general">All these sub-types of parameters are held in a <code>Parameters</code> struct, a general</a><a id="All-these-sub-types-of-parameters-are-held-in-a-Parameters-struct,-a-general-1"></a><a class="docs-heading-anchor-permalink" href="#All-these-sub-types-of-parameters-are-held-in-a-Parameters-struct,-a-general" title="Permalink"></a></h1><h1 id="parameters-structure-to-be-passed-to-an-ODINN-simulation."><a class="docs-heading-anchor" href="#parameters-structure-to-be-passed-to-an-ODINN-simulation.">parameters structure to be passed to an ODINN simulation.</a><a id="parameters-structure-to-be-passed-to-an-ODINN-simulation.-1"></a><a class="docs-heading-anchor-permalink" href="#parameters-structure-to-be-passed-to-an-ODINN-simulation." title="Permalink"></a></h1><h1 id="First-we-need-to-specify-a-list-of-RGI-IDs-of-the-glacier-we-want-to-work-with.-Specifying-an-RGI"><a class="docs-heading-anchor" href="#First-we-need-to-specify-a-list-of-RGI-IDs-of-the-glacier-we-want-to-work-with.-Specifying-an-RGI">First we need to specify a list of RGI IDs of the glacier we want to work with. Specifying an RGI</a><a id="First-we-need-to-specify-a-list-of-RGI-IDs-of-the-glacier-we-want-to-work-with.-Specifying-an-RGI-1"></a><a class="docs-heading-anchor-permalink" href="#First-we-need-to-specify-a-list-of-RGI-IDs-of-the-glacier-we-want-to-work-with.-Specifying-an-RGI" title="Permalink"></a></h1><h1 id="region-is-also-possible.-From-these-RGI-IDs,-we-will-look-for-the-necessary-files-inside-the-workspace."><a class="docs-heading-anchor" href="#region-is-also-possible.-From-these-RGI-IDs,-we-will-look-for-the-necessary-files-inside-the-workspace.">region is also possible. From these RGI IDs, we will look for the necessary files inside the workspace.</a><a id="region-is-also-possible.-From-these-RGI-IDs,-we-will-look-for-the-necessary-files-inside-the-workspace.-1"></a><a class="docs-heading-anchor-permalink" href="#region-is-also-possible.-From-these-RGI-IDs,-we-will-look-for-the-necessary-files-inside-the-workspace." title="Permalink"></a></h1><p>rgi<em>ids = [&quot;RGI60-11.03638&quot;, &quot;RGI60-11.01450&quot;, &quot;RGI60-11.02346&quot;, &quot;RGI60-07.00065&quot;, &quot;RGI60-08.00147&quot;,&quot;RGI60-07.00042&quot;] rgi</em>paths = get<em>rgi</em>paths()</p><h1 id="Filter-out-glaciers-that-are-not-used-to-avoid-having-references-that-depend-on-all-the-glaciers-processed-in-Gungnir"><a class="docs-heading-anchor" href="#Filter-out-glaciers-that-are-not-used-to-avoid-having-references-that-depend-on-all-the-glaciers-processed-in-Gungnir">Filter out glaciers that are not used to avoid having references that depend on all the glaciers processed in Gungnir</a><a id="Filter-out-glaciers-that-are-not-used-to-avoid-having-references-that-depend-on-all-the-glaciers-processed-in-Gungnir-1"></a><a class="docs-heading-anchor-permalink" href="#Filter-out-glaciers-that-are-not-used-to-avoid-having-references-that-depend-on-all-the-glaciers-processed-in-Gungnir" title="Permalink"></a></h1><p>rgi<em>paths = Dict(k =&gt; rgi</em>paths[k] for k in rgi_ids)</p><h2 id="Define-the-time-step-for-the-simulation-output-and-for-the-adjoint-calculation.-In-this-case,-a-month."><a class="docs-heading-anchor" href="#Define-the-time-step-for-the-simulation-output-and-for-the-adjoint-calculation.-In-this-case,-a-month.">Define the time step for the simulation output and for the adjoint calculation. In this case, a month.</a><a id="Define-the-time-step-for-the-simulation-output-and-for-the-adjoint-calculation.-In-this-case,-a-month.-1"></a><a class="docs-heading-anchor-permalink" href="#Define-the-time-step-for-the-simulation-output-and-for-the-adjoint-calculation.-In-this-case,-a-month." title="Permalink"></a></h2><p>δt = 1/12</p><p>params = Parameters(simulation = SimulationParameters(working<em>dir=working</em>dir,                                                     use<em>MB=false,                                                     velocities=true,                                                     tspan=(2010.0, 2015.0),                                                     step=δt,                                                     multiprocessing=true,                                                     workers=7,                                                     test</em>mode=false,                                                     rgi<em>paths=rgi</em>paths),                     hyper = Hyperparameters(batch<em>size=length(rgi</em>ids), # We set batch size equals all datasize so we test gradient                                             epochs=[50,50],                                             optimizer=[ODINN.ADAM(0.005), ODINN.LBFGS()]),                     physical = PhysicalParameters(minA = 8e-21,                                                   maxA = 8e-17),                     UDE = UDEparameters(optim<em>autoAD=ODINN.NoAD(),                                         grad=ContinuousAdjoint(),                                         optimization</em>method=&quot;AD+AD&quot;,                                         target = &quot;A&quot;),                     solver = Huginn.SolverParameters(step=δt,                                                      save_everystep=true,                                                      progress=true)                     )</p><h1 id="-Step-2:-Model-specification"><a class="docs-heading-anchor" href="#####-Step-2:-Model-specification">#### Step 2: Model specification</a><a id="-Step-2:-Model-specification-1"></a><a class="docs-heading-anchor-permalink" href="#####-Step-2:-Model-specification" title="Permalink"></a></h1><h1 id="The-next-step-is-to-specify-which-model(s)-we-want-to-use-for-our-simulation.-In-ODINN"><a class="docs-heading-anchor" href="#The-next-step-is-to-specify-which-model(s)-we-want-to-use-for-our-simulation.-In-ODINN">The next step is to specify which model(s) we want to use for our simulation. In ODINN</a><a id="The-next-step-is-to-specify-which-model(s)-we-want-to-use-for-our-simulation.-In-ODINN-1"></a><a class="docs-heading-anchor-permalink" href="#The-next-step-is-to-specify-which-model(s)-we-want-to-use-for-our-simulation.-In-ODINN" title="Permalink"></a></h1><h1 id="we-have-three-different-types-of-model,-which-are-encompassed-in-a-Model-structure:"><a class="docs-heading-anchor" href="#we-have-three-different-types-of-model,-which-are-encompassed-in-a-Model-structure:">we have three different types of model, which are encompassed in a <code>Model</code> structure:</a><a id="we-have-three-different-types-of-model,-which-are-encompassed-in-a-Model-structure:-1"></a><a class="docs-heading-anchor-permalink" href="#we-have-three-different-types-of-model,-which-are-encompassed-in-a-Model-structure:" title="Permalink"></a></h1><h1 id="*Iceflow-model*:-IceflowModel-is-the-ice-flow-dynamics-model-that-will-be-used-to-simulate"><a class="docs-heading-anchor" href="#*Iceflow-model*:-IceflowModel-is-the-ice-flow-dynamics-model-that-will-be-used-to-simulate">- <em>Iceflow model</em>: <code>IceflowModel</code> is the ice flow dynamics model that will be used to simulate</a><a id="*Iceflow-model*:-IceflowModel-is-the-ice-flow-dynamics-model-that-will-be-used-to-simulate-1"></a><a class="docs-heading-anchor-permalink" href="#*Iceflow-model*:-IceflowModel-is-the-ice-flow-dynamics-model-that-will-be-used-to-simulate" title="Permalink"></a></h1><h1 id="iceflow.-It-defaults-to-a-2D-Shallow-Ice-Approximation."><a class="docs-heading-anchor" href="#iceflow.-It-defaults-to-a-2D-Shallow-Ice-Approximation.">iceflow. It defaults to a 2D Shallow Ice Approximation.</a><a id="iceflow.-It-defaults-to-a-2D-Shallow-Ice-Approximation.-1"></a><a class="docs-heading-anchor-permalink" href="#iceflow.-It-defaults-to-a-2D-Shallow-Ice-Approximation." title="Permalink"></a></h1><h1 id="*Surface-mass-balance-model*:-MassBalanceModel-is-the-mass-balance-model-that-will-be-used-for"><a class="docs-heading-anchor" href="#*Surface-mass-balance-model*:-MassBalanceModel-is-the-mass-balance-model-that-will-be-used-for">- <em>Surface mass balance model</em>: <code>MassBalanceModel</code> is the mass balance model that will be used for</a><a id="*Surface-mass-balance-model*:-MassBalanceModel-is-the-mass-balance-model-that-will-be-used-for-1"></a><a class="docs-heading-anchor-permalink" href="#*Surface-mass-balance-model*:-MassBalanceModel-is-the-mass-balance-model-that-will-be-used-for" title="Permalink"></a></h1><h1 id="simulations.-Options-here-include-temperature-index-models,-or"><a class="docs-heading-anchor" href="#simulations.-Options-here-include-temperature-index-models,-or">simulations. Options here include temperature-index models, or</a><a id="simulations.-Options-here-include-temperature-index-models,-or-1"></a><a class="docs-heading-anchor-permalink" href="#simulations.-Options-here-include-temperature-index-models,-or" title="Permalink"></a></h1><h1 id="machine-learning-models-coming-from-MassBalanceMachine."><a class="docs-heading-anchor" href="#machine-learning-models-coming-from-MassBalanceMachine.">machine learning models coming from <code>MassBalanceMachine</code>.</a><a id="machine-learning-models-coming-from-MassBalanceMachine.-1"></a><a class="docs-heading-anchor-permalink" href="#machine-learning-models-coming-from-MassBalanceMachine." title="Permalink"></a></h1><h1 id="*Machine-learning-model*:-MLmodel-is-the-machine-learning-model-(e.g.-a-neural-network)-which-will"><a class="docs-heading-anchor" href="#*Machine-learning-model*:-MLmodel-is-the-machine-learning-model-(e.g.-a-neural-network)-which-will">- <em>Machine learning model</em>: <code>MLmodel</code> is the machine learning model (e.g. a neural network) which will</a><a id="*Machine-learning-model*:-MLmodel-is-the-machine-learning-model-(e.g.-a-neural-network)-which-will-1"></a><a class="docs-heading-anchor-permalink" href="#*Machine-learning-model*:-MLmodel-is-the-machine-learning-model-(e.g.-a-neural-network)-which-will" title="Permalink"></a></h1><h1 id="be-used-as-part-of-a-hybrid-model-based-on-a-Universal-Differential-Equation."><a class="docs-heading-anchor" href="#be-used-as-part-of-a-hybrid-model-based-on-a-Universal-Differential-Equation.">be used as part of a hybrid model based on a Universal Differential Equation.</a><a id="be-used-as-part-of-a-hybrid-model-based-on-a-Universal-Differential-Equation.-1"></a><a class="docs-heading-anchor-permalink" href="#be-used-as-part-of-a-hybrid-model-based-on-a-Universal-Differential-Equation." title="Permalink"></a></h1><h1 id="Generally,-a-model-can-be-initialized-directly-using-the-Model-constructor:"><a class="docs-heading-anchor" href="#Generally,-a-model-can-be-initialized-directly-using-the-Model-constructor:">Generally, a model can be initialized directly using the <code>Model</code> constructor:</a><a id="Generally,-a-model-can-be-initialized-directly-using-the-Model-constructor:-1"></a><a class="docs-heading-anchor-permalink" href="#Generally,-a-model-can-be-initialized-directly-using-the-Model-constructor:" title="Permalink"></a></h1><p>model = Model(iceflow = SIA2Dmodel(params),                 mass<em>balance = TImodel1(params; DDF=6.0/1000.0, acc</em>factor=1.2/1000.0),                 machine_learning = NeuralNetwork(params))</p><h1 id="-Step-3:-Glacier-initialization"><a class="docs-heading-anchor" href="#####-Step-3:-Glacier-initialization">#### Step 3: Glacier initialization</a><a id="-Step-3:-Glacier-initialization-1"></a><a class="docs-heading-anchor-permalink" href="#####-Step-3:-Glacier-initialization" title="Permalink"></a></h1><h1 id="The-third-step-is-to-fetch-and-initialize-all-the-necessary-data-for-our-glaciers-of-interest."><a class="docs-heading-anchor" href="#The-third-step-is-to-fetch-and-initialize-all-the-necessary-data-for-our-glaciers-of-interest.">The third step is to fetch and initialize all the necessary data for our glaciers of interest.</a><a id="The-third-step-is-to-fetch-and-initialize-all-the-necessary-data-for-our-glaciers-of-interest.-1"></a><a class="docs-heading-anchor-permalink" href="#The-third-step-is-to-fetch-and-initialize-all-the-necessary-data-for-our-glaciers-of-interest." title="Permalink"></a></h1><h1 id="This-is-strongly-built-on-top-of-OGGM,-mostly-providing-a-Julia-interface-to-automatize-this.-The-package"><a class="docs-heading-anchor" href="#This-is-strongly-built-on-top-of-OGGM,-mostly-providing-a-Julia-interface-to-automatize-this.-The-package">This is strongly built on top of OGGM, mostly providing a Julia interface to automatize this. The package</a><a id="This-is-strongly-built-on-top-of-OGGM,-mostly-providing-a-Julia-interface-to-automatize-this.-The-package-1"></a><a class="docs-heading-anchor-permalink" href="#This-is-strongly-built-on-top-of-OGGM,-mostly-providing-a-Julia-interface-to-automatize-this.-The-package" title="Permalink"></a></h1><h1 id="Gungnir-is-used-to-fetch-the-necessary-data-from-the-RGI-and-other-sources.-The-data-is-then-stored-in-servers"><a class="docs-heading-anchor" href="#Gungnir-is-used-to-fetch-the-necessary-data-from-the-RGI-and-other-sources.-The-data-is-then-stored-in-servers">Gungnir is used to fetch the necessary data from the RGI and other sources. The data is then stored in servers</a><a id="Gungnir-is-used-to-fetch-the-necessary-data-from-the-RGI-and-other-sources.-The-data-is-then-stored-in-servers-1"></a><a class="docs-heading-anchor-permalink" href="#Gungnir-is-used-to-fetch-the-necessary-data-from-the-RGI-and-other-sources.-The-data-is-then-stored-in-servers" title="Permalink"></a></h1><h1 id="and-fetched-and-read-using-Rasters.jl-directly-by-Sleipnir.jl-when-needed."><a class="docs-heading-anchor" href="#and-fetched-and-read-using-Rasters.jl-directly-by-Sleipnir.jl-when-needed.">and fetched and read using <code>Rasters.jl</code> directly by <code>Sleipnir.jl</code> when needed.</a><a id="and-fetched-and-read-using-Rasters.jl-directly-by-Sleipnir.jl-when-needed.-1"></a><a class="docs-heading-anchor-permalink" href="#and-fetched-and-read-using-Rasters.jl-directly-by-Sleipnir.jl-when-needed." title="Permalink"></a></h1><h1 id="Then,-we-initialize-those-glaciers-based-on-those-RGI-IDs-and-the-parameters-we-previously-specified."><a class="docs-heading-anchor" href="#Then,-we-initialize-those-glaciers-based-on-those-RGI-IDs-and-the-parameters-we-previously-specified.">Then, we initialize those glaciers based on those RGI IDs and the parameters we previously specified.</a><a id="Then,-we-initialize-those-glaciers-based-on-those-RGI-IDs-and-the-parameters-we-previously-specified.-1"></a><a class="docs-heading-anchor-permalink" href="#Then,-we-initialize-those-glaciers-based-on-those-RGI-IDs-and-the-parameters-we-previously-specified." title="Permalink"></a></h1><p>glaciers = initialize<em>glaciers(rgi</em>ids, params)</p><h1 id="-Step-4:-Running-a-forward-simulation-as-a-synthetic-ground-truth"><a class="docs-heading-anchor" href="#####-Step-4:-Running-a-forward-simulation-as-a-synthetic-ground-truth">#### Step 4: Running a forward simulation as a synthetic ground truth</a><a id="-Step-4:-Running-a-forward-simulation-as-a-synthetic-ground-truth-1"></a><a class="docs-heading-anchor-permalink" href="#####-Step-4:-Running-a-forward-simulation-as-a-synthetic-ground-truth" title="Permalink"></a></h1><p># The next step is to generate a synthetic dataset using a forward simulation. This will generate a dataset with the ice thickness and surface velocities</p><h1 id="for-each-glacier-at-each-time-step.-The-dataset-will-be-used-to-train-the-machine-learning-model."><a class="docs-heading-anchor" href="#for-each-glacier-at-each-time-step.-The-dataset-will-be-used-to-train-the-machine-learning-model.">for each glacier at each time step. The dataset will be used to train the machine learning model.</a><a id="for-each-glacier-at-each-time-step.-The-dataset-will-be-used-to-train-the-machine-learning-model.-1"></a><a class="docs-heading-anchor-permalink" href="#for-each-glacier-at-each-time-step.-The-dataset-will-be-used-to-train-the-machine-learning-model." title="Permalink"></a></h1><h1 id="We-define-the-time-snapshots-for-transient-inversion,-i.e.-the-time-steps-at-which-we-want-to-save-the-results,-which-will-be-used"><a class="docs-heading-anchor" href="#We-define-the-time-snapshots-for-transient-inversion,-i.e.-the-time-steps-at-which-we-want-to-save-the-results,-which-will-be-used">We define the time snapshots for transient inversion, i.e. the time steps at which we want to save the results, which will be used</a><a id="We-define-the-time-snapshots-for-transient-inversion,-i.e.-the-time-steps-at-which-we-want-to-save-the-results,-which-will-be-used-1"></a><a class="docs-heading-anchor-permalink" href="#We-define-the-time-snapshots-for-transient-inversion,-i.e.-the-time-steps-at-which-we-want-to-save-the-results,-which-will-be-used" title="Permalink"></a></h1><h1 id="to-compute-the-adjoint-in-reverse-mode."><a class="docs-heading-anchor" href="#to-compute-the-adjoint-in-reverse-mode.">to compute the adjoint in reverse mode.</a><a id="to-compute-the-adjoint-in-reverse-mode.-1"></a><a class="docs-heading-anchor-permalink" href="#to-compute-the-adjoint-in-reverse-mode." title="Permalink"></a></h1><p>tstops = collect(2010:δt:2015)</p><p>prediction = Prediction(model, glaciers, params)</p><h1 id="We-define-a-synthetic-law-to-generate-the-synthetic-dataset.-For-this,-we-use-the-data-from-a-table-in-Cuffey-and-Paterson-(2010)."><a class="docs-heading-anchor" href="#We-define-a-synthetic-law-to-generate-the-synthetic-dataset.-For-this,-we-use-the-data-from-a-table-in-Cuffey-and-Paterson-(2010).">We define a synthetic law to generate the synthetic dataset. For this, we use the data from a table in Cuffey and Paterson (2010).</a><a id="We-define-a-synthetic-law-to-generate-the-synthetic-dataset.-For-this,-we-use-the-data-from-a-table-in-Cuffey-and-Paterson-(2010).-1"></a><a class="docs-heading-anchor-permalink" href="#We-define-a-synthetic-law-to-generate-the-synthetic-dataset.-For-this,-we-use-the-data-from-a-table-in-Cuffey-and-Paterson-(2010)." title="Permalink"></a></h1><p>A<em>poly = ODINN.A</em>law<em>PatersonCuffey() fakeA(T) = A</em>poly(T)</p><h1 id="We-generate-the-synthetic-dataset-using-the-forward-simulation.-This-will-generate-a-dataset-with-the-ice-thickness-and-surface-velocities"><a class="docs-heading-anchor" href="#We-generate-the-synthetic-dataset-using-the-forward-simulation.-This-will-generate-a-dataset-with-the-ice-thickness-and-surface-velocities">We generate the synthetic dataset using the forward simulation. This will generate a dataset with the ice thickness and surface velocities</a><a id="We-generate-the-synthetic-dataset-using-the-forward-simulation.-This-will-generate-a-dataset-with-the-ice-thickness-and-surface-velocities-1"></a><a class="docs-heading-anchor-permalink" href="#We-generate-the-synthetic-dataset-using-the-forward-simulation.-This-will-generate-a-dataset-with-the-ice-thickness-and-surface-velocities" title="Permalink"></a></h1><h1 id="for-each-glacier-at-each-time-step.-The-dataset-will-be-used-to-train-the-machine-learning-model.-This-will-run-under-the-hood"><a class="docs-heading-anchor" href="#for-each-glacier-at-each-time-step.-The-dataset-will-be-used-to-train-the-machine-learning-model.-This-will-run-under-the-hood">for each glacier at each time step. The dataset will be used to train the machine learning model. This will run under the hood</a><a id="for-each-glacier-at-each-time-step.-The-dataset-will-be-used-to-train-the-machine-learning-model.-This-will-run-under-the-hood-1"></a><a class="docs-heading-anchor-permalink" href="#for-each-glacier-at-each-time-step.-The-dataset-will-be-used-to-train-the-machine-learning-model.-This-will-run-under-the-hood" title="Permalink"></a></h1><h1 id="a-Prediction-using-Huginn.jl."><a class="docs-heading-anchor" href="#a-Prediction-using-Huginn.jl.">a <code>Prediction</code> using <code>Huginn.jl</code>.</a><a id="a-Prediction-using-Huginn.jl.-1"></a><a class="docs-heading-anchor-permalink" href="#a-Prediction-using-Huginn.jl." title="Permalink"></a></h1><p>ODINN.generate<em>ground</em>truth(glaciers, :PatersonCuffey, params, model, tstops)</p><p># After this forward simulation, we restart the iceflow model to be ready for the inversions model.iceflow = SIA2Dmodel(params)</p><h1 id="-Step-5:-Train-a-Universal-Differential-Equation-via-a-functional-inversion"><a class="docs-heading-anchor" href="#####-Step-5:-Train-a-Universal-Differential-Equation-via-a-functional-inversion">#### Step 5: Train a Universal Differential Equation via a functional inversion</a><a id="-Step-5:-Train-a-Universal-Differential-Equation-via-a-functional-inversion-1"></a><a class="docs-heading-anchor-permalink" href="#####-Step-5:-Train-a-Universal-Differential-Equation-via-a-functional-inversion" title="Permalink"></a></h1><h1 id="The-next-step-is-to-specify-the-type-of-simulation-we-want-to-perform.-In-this-case,-we-will-use-a-FunctionalInversion-simulation,"><a class="docs-heading-anchor" href="#The-next-step-is-to-specify-the-type-of-simulation-we-want-to-perform.-In-this-case,-we-will-use-a-FunctionalInversion-simulation,">The next step is to specify the type of simulation we want to perform. In this case, we will use a <code>FunctionalInversion</code> simulation,</a><a id="The-next-step-is-to-specify-the-type-of-simulation-we-want-to-perform.-In-this-case,-we-will-use-a-FunctionalInversion-simulation,-1"></a><a class="docs-heading-anchor-permalink" href="#The-next-step-is-to-specify-the-type-of-simulation-we-want-to-perform.-In-this-case,-we-will-use-a-FunctionalInversion-simulation," title="Permalink"></a></h1><h1 id="which-will-use-the-synthetic-dataset-generated-in-the-previous-step-to-train-a-Universal-Differential-Equation-(UDE)-model."><a class="docs-heading-anchor" href="#which-will-use-the-synthetic-dataset-generated-in-the-previous-step-to-train-a-Universal-Differential-Equation-(UDE)-model.">which will use the synthetic dataset generated in the previous step to train a Universal Differential Equation (UDE) model.</a><a id="which-will-use-the-synthetic-dataset-generated-in-the-previous-step-to-train-a-Universal-Differential-Equation-(UDE)-model.-1"></a><a class="docs-heading-anchor-permalink" href="#which-will-use-the-synthetic-dataset-generated-in-the-previous-step-to-train-a-Universal-Differential-Equation-(UDE)-model." title="Permalink"></a></h1><p>functional_inversion = FunctionalInversion(model, glaciers, params)</p><h1 id="And-finally,-we-just-run-the-simulation.-This-will-run-the-adjoint-method-to-compute-the-gradients-and-then-use-the-ADAM-optimizer"><a class="docs-heading-anchor" href="#And-finally,-we-just-run-the-simulation.-This-will-run-the-adjoint-method-to-compute-the-gradients-and-then-use-the-ADAM-optimizer">And finally, we just run the simulation. This will run the adjoint method to compute the gradients and then use the ADAM optimizer</a><a id="And-finally,-we-just-run-the-simulation.-This-will-run-the-adjoint-method-to-compute-the-gradients-and-then-use-the-ADAM-optimizer-1"></a><a class="docs-heading-anchor-permalink" href="#And-finally,-we-just-run-the-simulation.-This-will-run-the-adjoint-method-to-compute-the-gradients-and-then-use-the-ADAM-optimizer" title="Permalink"></a></h1><h1 id="to-train-the-UDE-model."><a class="docs-heading-anchor" href="#to-train-the-UDE-model.">to train the UDE model.</a><a id="to-train-the-UDE-model.-1"></a><a class="docs-heading-anchor-permalink" href="#to-train-the-UDE-model." title="Permalink"></a></h1><p>run!(functional_inversion)</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../forward_simulation/">« Forward simulation</a><a class="docs-footer-nextpage" href="../funcs_types/">Types and functions »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.11.4 on <span class="colophon-date" title="Monday 19 May 2025 11:54">Monday 19 May 2025</span>. Using Julia version 1.10.9.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
